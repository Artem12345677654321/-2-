<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLATO RUG | INTERACTIVE P-28</title>
    
    <style>
        /* Базовый сброс и переменные */
        body { margin: 0; overflow-x: hidden; background-color: #000; color: #E0E0E0; cursor: none; font-family: 'Times New Roman', serif; }
        :root {
            --color-background: #000000;
            --color-text: #E0E0E0;
            --color-accent: #A08A6F; /* Золотисто-бронзовый */
        }

        /* WebGL Холст */
        #webgl-canvas { 
            position: fixed; 
            top: 0; left: 0; 
            z-index: 0; 
            display: block; 
        }

        /* HTML Контент */
        #content {
            position: relative;
            z-index: 10;
        }
        
        /* Увеличиваем высоту контента, чтобы было где скроллить для теста вращения */
        .section {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            text-align: center;
            padding: 0 10%;
            pointer-events: none; /* Пропускаем клики к канвасу */
        }
        .section > * {
            pointer-events: auto;
        }
        .section h1 { color: var(--color-accent); margin-bottom: 0.2em; }
        .section p { font-size: 0.5em; max-width: 600px; color: rgba(255,255,255,0.8); }
        .interactive-target { cursor: none; display: inline-block; padding: 5px 10px; border-bottom: 1px solid var(--color-accent); transition: color 0.3s; }
        .interactive-target:hover { color: #fff; }

        /* Кастомный Курсор */
        .cursor-outer, .cursor-inner {
            pointer-events: none;
            position: fixed;
            z-index: 9999;
            border-radius: 50%;
            top: 0; left: 0;
            transform: translate(-50%, -50%);
        }
        .cursor-outer {
            width: 40px; height: 40px;
            border: 1px solid rgba(160, 138, 111, 0.5);
            mix-blend-mode: exclusion;
            transition: width 0.3s, height 0.3s;
        }
        .cursor-inner {
            width: 8px; height: 8px;
            background-color: var(--color-accent);
        }
    </style>
    
    <!-- Scripts (Global CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "three": "https://aistudiocdn.com/three@^0.181.2",
    "gsap": "https://aistudiocdn.com/gsap@^3.13.0",
    "gsap/": "https://aistudiocdn.com/gsap@^3.13.0/"
  }
}
</script>
</head>
<body>
    <canvas id="webgl-canvas"></canvas>
    
    <div class="cursor-outer"></div>
    <div class="cursor-inner"></div>
    
    <div id="content">
        <div class="section" id="section-1">
            <h1>PLATO RUG</h1>
            <p>Интерактивная версия <span class="interactive-target">P-28</span>. Скролльте вниз.</p>
        </div>
        <div class="section" id="section-2">
            <h1>Dynamic Scroll</h1>
            <p>Ковер вращается при <span class="interactive-target">прокрутке</span> страницы.</p>
        </div>
        <div class="section" id="section-3">
            <h1>Interactive 3D</h1>
            <p>Используйте мышь для <span class="interactive-target">вращения</span> сцены (OrbitControls).</p>
        </div>
    </div>
    
    <script>
        // ==========================================================
        // I. WebGL Scene & Logic
        // ==========================================================
        console.log("Initializing P-28 Interactive...");

        const canvas = document.getElementById('webgl-canvas');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        // 1. Освещение
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
        directionalLight.position.set(5, 10, 7);
        scene.add(directionalLight);

        // 2. Объект (Плоскость-Ковер)
        const geometry = new THREE.PlaneGeometry(8, 8); 
        const material = new THREE.MeshPhongMaterial({ 
            color: 0x888888, 
            side: THREE.DoubleSide
        });
        const carpetPlane = new THREE.Mesh(geometry, material);
        carpetPlane.rotation.x = -Math.PI / 2; 
        scene.add(carpetPlane);

        // 3. Управление (P-28.1: OrbitControls Activated)
        camera.position.set(0, 5, 5);
        camera.lookAt(0, 0, 0);
        
        let controls;
        if (typeof THREE.OrbitControls !== 'undefined') {
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
        } else {
            console.warn('OrbitControls library not loaded');
        }

        // 4. Цикл Рендеринга
        function animate() {
            requestAnimationFrame(animate);
            
            // P-28.1: Обновление контроллера
            if (controls) {
                controls.update(); 
            }

            renderer.render(scene, camera);
        };
        animate();
        
        // 5. Ресайз
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ==========================================================
        // II. Custom Cursor
        // ==========================================================
        const cursorOuter = document.querySelector('.cursor-outer');
        const cursorInner = document.querySelector('.cursor-inner');
        
        gsap.set([cursorOuter, cursorInner], { x: -100, y: -100 });

        window.addEventListener('mousemove', (e) => {
            gsap.to(cursorInner, {
                x: e.clientX,
                y: e.clientY,
                duration: 0.1
            });
            gsap.to(cursorOuter, {
                x: e.clientX,
                y: e.clientY,
                duration: 0.3
            });
        });

        // ==========================================================
        // III. ScrollTrigger Animations (P-28.2 & P-28.3)
        // ==========================================================
        if (typeof ScrollTrigger !== 'undefined') {
            gsap.registerPlugin(ScrollTrigger);

            // P-28.2: Вращение ковра при скролле
            gsap.to(carpetPlane.rotation, {
                z: Math.PI * 2, // Полный оборот
                ease: "none",
                scrollTrigger: {
                    trigger: "#content",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: true
                }
            });

            // P-28.3: Анимация появления секций
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                gsap.from(section.children, {
                    opacity: 0,
                    y: 100, 
                    duration: 1.2,
                    ease: "power3.out",
                    scrollTrigger: {
                        trigger: section,
                        start: "top 85%",
                        toggleActions: "play none none none"
                    }
                });
            });
        } else {
            console.error('GSAP ScrollTrigger not loaded');
        }

        console.log("P-28: All Systems Go");

    </script>
</body>
</html>